# 游戏集成文档

## 简介

本文档概述了将游戏集成到现有系统中的过程。集成涉及多个组件，包括主文件 `gamep.php`，辅助文件如 `Atg.php`、`Evoapi.php` 和 `Api.php`（用于Golden F），以及数据库表，包括 `game_list`、`game_product`、`game_record`、`game_transaction` 和 `game_class`。

## 集成过程

### 获取游戏列表

开始集成过程的第一步是从各自的供应商获取可用游戏列表。这通过 `game_list` 表完成，该表存储关键信息，如 *供应商代码*、*游戏代码*、*钱包代码* 和每个游戏相关的图像。 `game_list` 表中的父项通过具有完整属性集来区分，而子项仅包含这些属性的子集，额外的细节通过使用 `productid` 列从 `game_product` 表中获取。

#### 密钥和令牌

访问游戏列表需要通过供应商提供的 *密钥* 和 *令牌* 进行身份验证。需要注意的是可能涉及两种类型的线路：生产线和暂存线。在这些线路之间转换时，修改密钥和令牌模式是必要的。

#### 启动选项

`game_list` 表中的 `is_launch` 字段确定是否直接播放项目（值为1）还是启动到大厅（值为0）。对于具有子元素的项目，父项目的启动选项设置为0，而子项目继承此值。

### 游戏操作

#### 查询余额

`queryBalance` API端点使用户能够查询与其帐户关联的游戏余额。这对于各种游戏交易和操作至关重要。

#### 管理游戏子项

`getGameChildList` API端点便于检索与特定游戏相关联的子项。这对于向玩家展示全面的游戏选择非常重要。

#### 启动游戏

`launch` API端点提供启动游戏并获取相应播放URL的必要功能。需要调整父项的令牌、游戏代码和供应商代码以生成正确的URL。

### 转账操作

#### 转账到游戏

从应用程序转账到游戏环境可以通过 `TransferAcc` API端点实现。此操作更新游戏中的玩家余额，使他们能够参与各种游戏活动。

#### 从游戏转账

玩游戏并累积赢利后，玩家可以选择从游戏环境转账回主应用程序。此功能确保游戏平台与更广泛的应用程序生态系统之间的无缝交互。

## 投注记录

### 数据来源

投注记录来自多个供应商，ATG提供5分钟记录，Golden F提供过去2个月的记录。将这些记录集成到系统中对于跟踪玩家活动和分析游戏趋势至关重要。

### 记录插入

`query_bet_record` API端点促使将从供应商获取的投注记录插入到 `game_record` 表中。这确保了在系统内捕获和处理所有相关的游戏数据。

### 后台任务

后台cron任务定期运行，通常每3分钟一次，从ATG、Evo和Golden F获取投注记录。务必注意防止重复记录插入到 `game_record` 表中，确保数据的完整性和准确性。

### 管理员访问

管理员可以从管理面板或后台系统中检索和分析投注记录。系统应默认提供过去2个月的记录访问权限，使管理员能够深入了解玩家行为和整体游戏表现。

## 回顾

在集成过程中，涉及以下API和表：

1. **APIs**:
   - `queryBalance`
   - `getGameChildList`
   - `launch`
   - `TransferAcc`
   - `query_bet_record`

2. **Tables**:
   - `game_list`
   - `game_product`
   - `game_record`
   - `game_transaction`
   - `game_class`

这些组件在将游戏无缝集成到现有系统中发挥了关键作用，确保玩家的游戏体验顺畅。
